-- INSERT INTO npc VALUES (nextval('npc_seq'),1,-135,-400,0,4,false,'Daerbur Wimbert','npc_daerbur_wimbert.lua',0);

require("npcs.base.autonpcfunctions")

function useNPC(user,counter,param)
    thisNPC:increaseSkill(1,"common language",100);
    thisNPC:talkLanguage(CCharacter.say, CPlayer.german, "Finger weg!");
    thisNPC:talkLanguage(CCharacter.say, CPlayer.english, "Don't you touch me!");
end

function initializeNpc()
    if TraderFirst then
        return true;
    end

    InitTalkLists();

    -- ********* START DYNAMIC PART ********

    QuestID = 68;
    -- NPC by Estralis Seborian
    -- Queststatus Overview
    -- 0: No Quest taken
    -- 1: Quest 1 taken - gather 10 raw materials for 50cp
    -- 2: Quest 1 solved
    -- 3: Quest 2 taken - gather 20 raw materials for 100cp
    -- 4: Quest 2 solved
    -- 5: Quest 3 taken - gather 5 rare raw materials for 100cp
    -- 6: Quest 3 solved
    -- 7: Quest 4 taken - gather 10 distant raw materials for 200cp
    -- 8: Quest 4 solved
    -- Debugging
    AddTraderTrigger("set 0","Quest status set to 0");
    AddConsequence("qpg","=",0);
    AddTraderTrigger("set 1","Quest status set to 1");
    AddConsequence("qpg","=",1);
    AddTraderTrigger("set 2","Quest status set to 2");
    AddConsequence("qpg","=",2);
    AddTraderTrigger("set 3","Quest status set to 3");
    AddConsequence("qpg","=",3);
    AddTraderTrigger("set 4","Quest status set to 4");
    AddConsequence("qpg","=",4);
    AddTraderTrigger("set 5","Quest status set to 5");
    AddConsequence("qpg","=",5);
    AddTraderTrigger("set 6","Quest status set to 6");
    AddConsequence("qpg","=",6);
    AddTraderTrigger("set 7","Quest status set to 7");
    AddConsequence("qpg","=",7);
    AddTraderTrigger("set 8","Quest status set to 8");
    AddConsequence("qpg","=",8);
    -- Help 
    AddTraderTrigger("Help","");
    AddConsequence("inform","[Game Help] This NPC is the miner Daerbur Wimbert. Keyphrases: Hello, quest, pick-axe, miner.");
    AddTraderTrigger("Hilfe","");
    AddConsequence("inform","[Spielhilfe] Dieser NPC ist der Bergarbeiter Daerbur Wimbert. Schlüsselwörter: Hallo, Quest, Spitzhacke, Bergarbeiter.");
    -- General speech
    AddTraderTrigger("Hello","Huh?");
    AddAdditionalTrigger("Greetings");
    AddAdditionalTrigger("Be greeted");
    AddAdditionalTrigger("Hail");
    AddAdditionalTrigger("Good day");
    AddAdditionalTrigger("Good morning");
    AddAdditionalTrigger("Good evening");
    AddAdditionalText("Hah?");
    AddAdditionalText("Heh?");
    AddAdditionalText("Hih?");
    AddAdditionalText("Hoh?");
    AddTraderTrigger("Grüße","Huh?");
    AddAdditionalTrigger("Gruß");
    AddAdditionalTrigger("Seid gegrüßt");
    AddAdditionalTrigger("Guten Tag");
    AddAdditionalTrigger("Guten Abend");
    AddAdditionalTrigger("Mahlzeit");
    AddAdditionalTrigger("Tach");
    AddAdditionalTrigger("Moin");
    AddAdditionalText("Hah?");
    AddAdditionalText("Heh?");
    AddAdditionalText("Hih?");
    AddAdditionalText("Hoh?");
    AddAdditionalText("Häh?");
    AddAdditionalText("Höh?");
    AddAdditionalText("Hüh?");
    AddTraderTrigger("Hiho","Huh?");
    AddAdditionalTrigger("Hallo");
    AddAdditionalTrigger("Hey");
    AddAdditionalTrigger("Greebas");
    AddAdditionalTrigger("Greebs");
    AddCondition("lang","english");
    AddAdditionalText("Hah?");
    AddAdditionalText("Heh?");
    AddAdditionalText("Hih?");
    AddAdditionalText("Hoh?");
    AddTraderTrigger("Hiho","Huh?");
    AddAdditionalTrigger("Hallo");
    AddAdditionalTrigger("Hey");
    AddAdditionalTrigger("Greebas");
    AddAdditionalTrigger("Greebs");
    AddCondition("lang","german");
    AddAdditionalText("Hah?");
    AddAdditionalText("Heh?");
    AddAdditionalText("Hih?");
    AddAdditionalText("Hoh?");
    AddAdditionalText("Häh?");
    AddAdditionalText("Höh?");
    AddAdditionalText("Hüh?");
    AddTraderTrigger("Farewell","So, you are leaving. That is interesting, that means, you go somewhere else. Exciting!");
    AddAdditionalTrigger("Good bye");
    AddAdditionalTrigger("Bye");
    AddAdditionalTrigger("Fare thy well");
    AddAdditionalText("Why did you come if you wanted to leave anyway? You like change to your life, I assume.");
    AddAdditionalText("Bye");
    AddTraderTrigger("Tschüß","So, du gehst also. Das ist interessant, denn das bedeutet, dass du woanders hingehst. Wie spanned!");
    AddAdditionalTrigger("Tschüss");
    AddAdditionalTrigger("Wiedersehen");
    AddAdditionalTrigger("Gehabt euch wohl");
    AddAdditionalText("Wieso bist du überhaupt gekommen, wenn du eh wieder gehen wolltest? Du magst Veränderungen in deinem Leben, richtig?");
    AddAdditionalText("Tschüß!");
    AddTraderTrigger("Ciao","So, you are leaving. That is interesting, that means, you go somewhere else. Exciting!");
    AddAdditionalTrigger("Adieu");
    AddAdditionalTrigger("Au revoir");
    AddCondition("lang","english");
    AddAdditionalText("Why did you come if you wanted to leave anyway? You like change to your life, I assume.");
    AddAdditionalText("Bye.");
    AddTraderTrigger("Ciao","So, du gehst also. Das ist interessant, denn das bedeutet, dass du woanders hingehst. Wie spanned!");
    AddAdditionalTrigger("Adieu");
    AddAdditionalTrigger("Au revoir");
    AddCondition("lang","german");
    AddAdditionalText("Wieso bist du überhaupt gekommen, wenn du eh wieder gehen wolltest? Du magst Veränderungen in deinem Leben, richtig?");
    AddAdditionalText("Tschüß!");
    AddTraderTrigger("How are you","Good and bad at once I feel. Sometimes, I feel a bit more bad than good, sometimes vice versa.");
    AddAdditionalTrigger("How feel");
    AddAdditionalTrigger("How do you do");
    AddAdditionalText("I feel just like you, maybe a bit more sad or lucky, who knows.");
    AddAdditionalText("Wie fühlst du dich denn so? Ach, warum haben Leute kein Gefühlssinn, dann würde das dusselige Fragen entfallen.");
    AddTraderTrigger("Wie geht","Gut und schlecht gleichzeitig, so fühl ich mich. Manchmal ein bisschen mehr schlecht als gut, manchmal genau anders herum.");
    AddAdditionalTrigger("Wie fühlst");
    AddAdditionalTrigger("Wie ist es ergangen");
    AddAdditionalText("Ich fühl mich genauso wie du, vielleicht ein wenig schlechter oder besser, wer weiß das schon.");
    AddAdditionalText("How do you feel? Alas, why don't we all have a sense for feelings, then, all these stupid questions would be unnecessary.");
    AddTraderTrigger("your name","Daerbur Wimbert.");
    AddAdditionalTrigger("who are you");
    AddAdditionalTrigger("who art thou");
    AddAdditionalText("Daerbur.");
    AddAdditionalText("Daerbur Wimbert, son of Dimbur Wimbert and Klemka Jebmil, brother of Turgen Wimbert and Nadla Wimbert. That's me.");
    AddTraderTrigger("dein name","Daerbur Wimbert.");
    AddAdditionalTrigger("wer bist du");
    AddAdditionalTrigger("wer seid ihr");
    AddAdditionalTrigger("wie heißt");
    AddAdditionalText("Daerbur.");
    AddAdditionalText("Daerbur Wimbert, Sohn von Dimbur Wimbert und Klemka Jebmil, Bruder von Turgen Wimbert und Nadla Wimbert. Das bin ich.");
    -- Catching typical NPC phrases 
    AddTraderTrigger("what sell","I sell nothing to you, you sell nothing to me. Everyone keeps his property, fine.");
    AddAdditionalTrigger("what buy");
    AddAdditionalTrigger("list wares");
    AddAdditionalTrigger("price of");
    AddAdditionalText("You have enough, I have enough, so why trade?");
    AddAdditionalText("Bartering is so stupid, don't we all want to betray each other?");
    AddTraderTrigger("was verkauf","Ich verkaufe dir nichts, du verkaufst mir nichts. Jeder behält, was er hat, gut, nicht?");
    AddAdditionalTrigger("was kauf");
    AddAdditionalTrigger("warenliste");
    AddAdditionalTrigger("preis von");
    AddAdditionalText("Du hast genug, ich hab genug, also warum handeln?");
    AddAdditionalText("Feilschen ist ziemlich dusselig, will doch jeder nur den anderen hehupsen.");
    AddTraderTrigger("tell something","Once upon a time, in land far far away... I forgot the rest. But this line thrills me!");
    AddAdditionalText("And they all died happily ever after... I'm not a good story teller.");
    AddAdditionalText("What shall I tell you, fairytales? Better ask a fairy!");
    AddTraderTrigger("erzähl was","Es war einmal in einem fernen Land, hinter den sieben Bergen... Den Rest hab ich vergessen, aber diese Zeile ist der Hammer.");
    AddAdditionalTrigger("erzähl etwas");
    AddAdditionalText("Und wenn sie nicht noch leben, sind sie wohl gestorben... Ich bin nicht gut darin, Geschichten zu erzählen.");
    AddAdditionalText("Was soll ich dir erzählen, Märchen? Frage lieber eine Fee danach.");
    -- Small talk: The talk here should focus on possible questions. Feel free to add more!
    AddTraderTrigger("miner","I dig for gems, metals, and holes.");
    AddAdditionalText("Once, I dug a hole and some stinky, black fluid squirted out. Bah!");
    AddAdditionalText("If you find any gems, well, do not pick them up or nobody else can find them anymore.");
    AddTraderTrigger("Bergarbeiter","Ich grabe nach Edelsteinen, Metallen und Löchern.");
    AddAdditionalText("Einmal hab ich ein Loch gegraben und da spritze so eine schwarze, stinkende Flüssigkeit raus. Bah!");
    AddAdditionalText("Wenn du Edelsteine findest, lass sie doch liegen, sonst kann sie kein anderer mehr finden.");
    AddTraderTrigger("dark hole","It is not dark down here, you just need a torch.");
    AddCondition("lang","english");
    AddAdditionalText("A nice mine, isn't it? All mine in this mine, hehe.");
    AddTraderTrigger("Dunkelloch","Es ist doch nicht dunkel hier unten, du brauchst nur eine Fackel.");
    AddCondition("lang","german");
    AddAdditionalText("Eine schöne Mine, nicht wahr? Alles meins hier unten!");
    AddTraderTrigger("mine","It is not dark down here, you just need a torch.");
    AddCondition("lang","english");
    AddAdditionalText("A nice mine, isn't it? All mine in this mine, hehe.");
    AddTraderTrigger("Mine","Es ist doch nicht dunkel hier unten, du brauchst nur eine Fackel.");
    AddCondition("lang","german");
    AddAdditionalText("Eine schöne Mine, nicht wahr? Alles meins hier unten!");
    -- Factions
    AddTraderTrigger("Runewick","In Runewick, da sind sie dick!");
    AddCondition("lang","german");
    AddTraderTrigger("Runewick","Runewick, that makes me sick!");
    AddCondition("lang","english");
    AddTraderTrigger("Galmair","Ja, Galmair, das ist hier!");
    AddCondition("lang","german");
    AddTraderTrigger("Galmair","Yes, Galmair, that is here!");
    AddCondition("lang","english");
    AddTraderTrigger("Cadomyr","Cadomyr, das verbitt' ich mir!");
    AddCondition("lang","german");
    AddTraderTrigger("Cadomyr","Cadomyr, won't come here!");
    AddCondition("lang","english");
    -- Tool hints
    AddTraderTrigger("pick","You look like somebody who can swing a pick. Everybody does, at least I think so. Perhaps you can do a task for me.");
    AddCondition("qpg","=",0);
    AddTraderTrigger("hacke","Du siehst aus wie jemand, der eine Spitzhacke schwingen kann. Naja, jeder sieht so aus, denk ich. Vielleicht kannst du einen Auftrag für mich ausführen.");
    AddCondition("qpg","=",0);
    AddTraderTrigger("pick","Need a pick, it has a nick. In Galmair, you get a new one.");
    AddTraderTrigger("hacke","Brauchst 'ne Hacke, war die letzte kacke. In Galmair kriegst du eine neue.");
    -- 1st quest: Take a tool and gather 10 raw materials for 50cp.
    AddTraderTrigger("quest","Somehow, all rocks have decided to lay down on the gems. Can you collect ten stone blocks with this pick so I can reach the gems underneath?");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",0);
    AddCondition("lang","english");
    AddConsequence("item",2763,1,399,0);
    AddConsequence("qpg","=",1);
    AddConsequence("inform","[New quest] Dark Hole Mine I");
    AddTraderTrigger("quest","Aus irgendeinem Grund haben die Felsen beschlossen, sich auf die Edelsteine zu legen. Kannst du zehn Steinblöcke mit dieser Spitzhacke sammeln, damit ich an die Edelsteine darunter komme?");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",0);
    AddCondition("lang","german");
    AddConsequence("item",2763,1,399,0);
    AddConsequence("qpg","=",1);
    AddConsequence("inform","[Neues Quest] Dunkellochmine I");
    AddTraderTrigger("task","Somehow, all rocks have decided to lay down on the gems. Can you collect ten stone blocks with this pick so I can reach the gems underneath?");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",0);
    AddConsequence("item",2763,1,399,0);
    AddConsequence("qpg","=",1);
    AddConsequence("inform","[New quest] Dark Hole Mine I");
    AddTraderTrigger("Auftrag","Aus irgendeinem Grund haben die Felsen beschlossen, sich auf die Edelsteine zu legen. Kannst du zehn Steinblöcke mit dieser Spitzhacke sammeln, damit ich an die Edelsteine darunter komme?");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",0);
    AddConsequence("item",2763,1,399,0);
    AddConsequence("qpg","=",1);
    AddConsequence("inform","[Neues Quest] Dunkellochmine I");
    AddTraderTrigger("quest","Away with those rocks! Bring me ten stone blocks and I'll reward you.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",1);
    AddCondition("lang","english");
    AddTraderTrigger("quest","Weg mit den Steinen! Bring mir zehn Blöcke und ich belohne dich.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",1);
    AddCondition("lang","german");
    AddTraderTrigger("task","Away with those rocks! Bring me ten stone blocks and I'll reward you.");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",1);
    AddTraderTrigger("Auftrag","Weg mit den Steinen! Bring mir zehn Blöcke und ich belohne dich.");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",1);
    AddTraderTrigger(".+","Perfekt. Warum wachsen den Steinen eigentlich keine Beine, dann könnten wir uns das Geschleppe sparen. Hier ist deine Belohnung.");
    AddCondition("qpg","=",1);
    AddCondition("item",733,"all",">",9);
    AddCondition("town","=","galmair");
    AddCondition("lang","german");
    AddConsequence("deleteitem",733,10);
    AddConsequence("inform","[Quest gelöst] Du erhältst 50 Kupferstücke und deine Bergbaufertigkeit steigt. Dein Ansehen bei Don Valerio Guilianni steigt.");
    AddConsequence("rankpoints","galmair","+",5);
    AddConsequence("money","+",50);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",2);
    AddTraderTrigger(".+","Perfect. Why have rocks no legs so we could stop carrying them? Here is your reward.");
    AddCondition("qpg","=",1);
    AddCondition("item",733,"all",">",9);
    AddCondition("town","=","galmair");
    AddCondition("lang","english");
    AddConsequence("deleteitem",733,10);
    AddConsequence("inform","[Quest solved] You are awarded 50 copper coins and your mining skill increases. You advance in Don Valerio Guilianni's favour.");
    AddConsequence("rankpoints","galmair","+",5);
    AddConsequence("money","+",50);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",2);
    AddTraderTrigger(".+","Perfekt. Warum wachsen den Steinen eigentlich keine Beine, dann könnten wir uns das Geschleppe sparen. Hier ist deine Belohnung.");
    AddCondition("qpg","=",1);
    AddCondition("item",733,"all",">",9);
    AddCondition("lang","german");
    AddConsequence("deleteitem",733,10);
    AddConsequence("inform","[Quest gelöst] Du erhältst 50 Kupferstücke und deine Bergbaufertigkeit steigt.");
    AddConsequence("money","+",50);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",2);
    AddTraderTrigger(".+","Perfect. Why have rocks no legs so we could stop carrying them? Here is your reward.");
    AddCondition("qpg","=",1);
    AddCondition("item",733,"all",">",9);
    AddCondition("lang","english");
    AddConsequence("deleteitem",733,10);
    AddConsequence("inform","[Quest solved] You are awarded 50 copper coins and your mining skill increases.");
    AddConsequence("money","+",50);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",2);
    AddTraderTrigger(".+","Weg mit den Steinen! Bring mir zehn Blöcke und ich belohne dich.");
    AddCondition("qpg","=",1);
    AddCondition("item",733,"all","<",10);
    AddCondition("lang","german");
    AddTraderTrigger(".+","Away with those rocks! Bring me ten stone blocks and I'll reward you.");
    AddCondition("qpg","=",1);
    AddCondition("item",733,"all","<",10);
    AddCondition("lang","english");
    -- 2nd quest: Gather 20 different raw materials for 100cp.
    AddTraderTrigger("quest","There is so much coal on top of the gems. Can you dig away twenty lumps of coal and bring them to me?");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",2);
    AddCondition("lang","english");
    AddConsequence("qpg","=",3);
    AddConsequence("inform","[New quest] Dark Hole Mine II");
    AddTraderTrigger("quest","Es liegt eindeutig zu viel Kohle über den Edelsteinen. Schippst du bitte zwanzig Klumpen weg und bringst sie mir?");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",2);
    AddCondition("lang","german");
    AddConsequence("qpg","=",3);
    AddConsequence("inform","[Neues Quest] Dunkellochmine II");
    AddTraderTrigger("task","There is so much coal on top of the gems. Can you dig away twenty lumps of coal and bring them to me?");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",2);
    AddConsequence("qpg","=",3);
    AddConsequence("inform","[New quest] Dark Hole Mine II");
    AddTraderTrigger("Auftrag","Es liegt eindeutig zu viel Kohle über den Edelsteinen. Schippst du bitte zwanzig Klumpen weg und bringst sie mir?");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",2);
    AddConsequence("qpg","=",3);
    AddConsequence("inform","[Neues Quest] Dunkellochmine II");
    AddTraderTrigger("quest","There is so much coal on top of the gems. Can you dig away twenty lumps of coal and bring them to me?");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",3);
    AddCondition("lang","english");
    AddTraderTrigger("quest","Es liegt eindeutig zu viel Kohle über den Edelsteinen. Schippst du bitte zwanzig Klumpen weg und bringst sie mir?");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",3);
    AddCondition("lang","german");
    AddTraderTrigger("task","There is so much coal on top of the gems. Can you dig away twenty lumps of coal and bring them to me?");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",3);
    AddTraderTrigger("Auftrag","Es liegt eindeutig zu viel Kohle über den Edelsteinen. Schippst du bitte zwanzig Klumpen weg und bringst sie mir?");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",3);
    AddTraderTrigger(".+","Wie wundervoll! Weg ist die Kohle, nun geht's ans Eingemachte. Hier, dein Lohn, gib es nicht alles auf einmal aus.");
    AddCondition("qpg","=",3);
    AddCondition("item",21,"all",">",19);
    AddCondition("town","=","galmair");
    AddCondition("lang","german");
    AddConsequence("deleteitem",21,20);
    AddConsequence("inform","[Quest gelöst] Du erhältst 100 Kupferstücke und deine Bergbaufertigkeit steigt. Dein Ansehen bei Don Valerio Guilianni steigt.");
    AddConsequence("rankpoints","galmair","+",10);
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",4);
    AddTraderTrigger(".+","How marvelous! Away is the coal, now we can get things done. Here, your reward, don't spend it all at once.");
    AddCondition("qpg","=",3);
    AddCondition("item",21,"all",">",19);
    AddCondition("town","=","galmair");
    AddCondition("lang","english");
    AddConsequence("deleteitem",21,20);
    AddConsequence("inform","[Quest solved] You are awarded 100 copper coins and your mining skill increases. You advance in Don Valerio Guilianni's favour.");
    AddConsequence("rankpoints","galmair","+",10);
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",4);
    AddTraderTrigger(".+","Wie wundervoll! Weg ist die Kohle, nun geht's ans Eingemachte. Hier, dein Lohn, gib es nicht alles auf einmal aus.");
    AddCondition("qpg","=",3);
    AddCondition("item",21,"all",">",19);
    AddCondition("lang","german");
    AddConsequence("deleteitem",21,20);
    AddConsequence("inform","[Quest gelöst] Du erhältst 100 Kupferstücke und deine Bergbaufertigkeit steigt.");
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",4);
    AddTraderTrigger(".+","How marvelous! Away is the coal, now we can get things done. Here, your reward, don't spend it all at once.");
    AddCondition("qpg","=",3);
    AddCondition("item",21,"all",">",19);
    AddCondition("lang","english");
    AddConsequence("deleteitem",21,20);
    AddConsequence("inform","[Quest solved] You are awarded 100 copper coins and your mining skill increases.");
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",4);
    AddTraderTrigger(".+","Grabe weiter, es liegt immernoch so viel Kohle über den Edelsteinen.");
    AddCondition("qpg","=",3);
    AddCondition("item",21,"all","<",20);
    AddCondition("lang","german");
    AddTraderTrigger(".+","Dig some more, there is still so much coal atop the gems.");
    AddCondition("qpg","=",3);
    AddCondition("item",21,"all","<",20);
    AddCondition("lang","english");
    -- 3rd quest: Gather 5 rare raw materials for 100cp.
    AddTraderTrigger("quest","Hey-ho! Now we can dig for gems. Gather five raw blackstones for me and I will reward you generously.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",4);
    AddCondition("lang","english");
    AddConsequence("qpg","=",5);
    AddConsequence("inform","[New quest] Dark Hole Mine III");
    AddTraderTrigger("quest","Hey-ho! Jetzt können wir nach Edelsteinen graben. Bring mir fünf ungeschliffene Schwarzsteine und ich belohne dich großzügig.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",4);
    AddCondition("lang","german");
    AddConsequence("qpg","=",5);
    AddConsequence("inform","[Neues Quest] Dunkellochmine III");
    AddTraderTrigger("task","Heydiho! Now we can dig for gems. Gather five raw blackstones for me and I will reward you generously.");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",4);
    AddConsequence("qpg","=",5);
    AddConsequence("inform","[New quest] Dark Hole Mine III");
    AddTraderTrigger("Auftrag","Heydiho! Jetzt können wir nach Edelsteinen graben. Bring mir fünf ungeschliffene Schwarzsteine und ich belohne dich großzügig");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",4);
    AddConsequence("qpg","=",5);
    AddConsequence("inform","[Neues Quest] Dunkellochmine III");
    AddTraderTrigger("quest","Bring me five raw blackstones and you get money. I'm so excited!");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",5);
    AddCondition("lang","english");
    AddTraderTrigger("quest","Bring mir fünf ungeschliffene Schwarzsteine und du bekommst Geld. Ich bin so aufgeregt!");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",5);
    AddCondition("lang","german");
    AddTraderTrigger("task","Bring me five raw blackstones and you get money. I'm so excited!");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",5);
    AddTraderTrigger("Auftrag","Bring mir fünf ungeschliffene Schwarzsteine und du bekommst Geld. Ich bin so aufgeregt!");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",5);
    AddTraderTrigger(".+","Danke für die Edelsteine. Du fragst dich, was ich mit ihnen mache? Ich verstecke sie in einer anderen Höhle!");
    AddCondition("qpg","=",5);
    AddCondition("item",252,"all",">",4);
    AddCondition("town","=","galmair");
    AddCondition("lang","german");
    AddConsequence("deleteitem",252,5);
    AddConsequence("inform","[Quest gelöst] Du erhältst 100 Kupferstücke und deine Bergbaufertigkeit steigt. Dein Ansehen bei Don Valerio Guilianni steigt.");
    AddConsequence("rankpoints","galmair","+",15);
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",6);
    AddTraderTrigger(".+","Thank you for the gems. You wonder what I want to do with them? I hide them in another cave!");
    AddCondition("qpg","=",5);
    AddCondition("item",252,"all",">",4);
    AddCondition("town","=","galmair");
    AddCondition("lang","english");
    AddConsequence("deleteitem",252,5);
    AddConsequence("inform","[Quest solved] You are awarded 100 copper coins and your mining skill increases. You advance in Don Valerio Guilianni's favour.");
    AddConsequence("rankpoints","galmair","+",15);
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",6);
    AddTraderTrigger(".+","Danke für die Edelsteine. Du fragst dich, was ich mit ihnen mache? Ich verstecke sie in einer anderen Höhle!");
    AddCondition("qpg","=",5);
    AddCondition("item",252,"all",">",4);
    AddCondition("lang","german");
    AddConsequence("deleteitem",252,5);
    AddConsequence("inform","[Quest gelöst] Du erhältst 100 Kupferstücke und deine Bergbaufertigkeit steigt.");
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",6);
    AddTraderTrigger(".+","Thank you for the gems. You wonder what I want to do with them? I hide them in another cave!");
    AddCondition("qpg","=",5);
    AddCondition("item",252,"all",">",4);
    AddCondition("lang","english");
    AddConsequence("deleteitem",252,5);
    AddConsequence("inform","[Quest solved] You are awarded 100 copper coins and your mining skill increases.");
    AddConsequence("money","+",100);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",6);
    AddTraderTrigger(".+","Mehr Edelsteine, bitte. Ich brauche wenigstens fünf ungeschliffene Schwarzsteine, ja?");
    AddCondition("qpg","=",5);
    AddCondition("item",252,"all","<",5);
    AddCondition("lang","german");
    AddTraderTrigger(".+","Some more gems, please. I need five raw blackstones, not less, yes?");
    AddCondition("qpg","=",5);
    AddCondition("item",252,"all","<",5);
    AddCondition("lang","english");
    -- 4th quest: Gather 10 raw materials from a totally different location for 200cp. Link to other quest. Hint how to get there.
    AddTraderTrigger("quest","Watch out! The ceiling is instable, run and bring me ten logs of conifer wood to support the ceiling. You get the best wood from Elstree forest.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",6);
    AddCondition("lang","english");
    AddConsequence("qpg","=",7);
    AddConsequence("inform","[New quest] Dark Hole Mine IV");
    AddTraderTrigger("quest","Vorsicht! Die Höhlendecke ist einsturzgefährdet, lauf und bring mir zehn Nadelholzstämme um die Decke abzustützen. Das beste Holz bekommst du im Elsbaumwald.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",6);
    AddCondition("lang","german");
    AddConsequence("qpg","=",7);
    AddConsequence("inform","[Neues Quest] Dunkellochmine IV");
    AddTraderTrigger("task","Watch out! The ceiling is instable, run and bring me ten logs of conifer wood to support the ceiling. You get the best wood from Elstree forest.");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",6);
    AddConsequence("qpg","=",7);
    AddConsequence("inform","[New quest] Dark Hole Mine IV");
    AddTraderTrigger("Auftrag","Vorsicht! Die Höhlendecke ist einsturzgefährdet, lauf und bring mir zehn Nadelholzstämme um die Decke abzustützen. Das beste Holz bekommst du im Elsbaumwald.");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",6);
    AddConsequence("qpg","=",7);
    AddConsequence("inform","[Neues Quest] Dunkellochmine IV");
    AddTraderTrigger("quest","Beware of the forester Valandil if you venture to Elstree forest to bring me logs of conifer wood.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",7);
    AddCondition("lang","english");
    AddTraderTrigger("quest","Nimm dich vor dem Förster Valandil in acht, wenn du in den Elsbaumwald gehst, um mir Nadelholzstämme zu holen.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",7);
    AddCondition("lang","german");
    AddTraderTrigger("task","Beware of the forester Valandil if you venture to Elstree forest to bring me logs of conifer wood.");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",7);
    AddTraderTrigger("Auftrag","Nimm dich vor dem Förster Valandil in acht, wenn du in den Elsbaumwald gehst, um mir Nadelholzstämme zu holen.");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",7);
    AddTraderTrigger(".+","Oh, gut, Holz! Fällt mir hier unten nicht nur nicht der Himmel, sondern auch nicht die Decke auf den Kopf.");
    AddCondition("qpg","=",7);
    AddCondition("item",3,"all",">",9);
    AddCondition("town","=","galmair");
    AddCondition("lang","german");
    AddConsequence("deleteitem",3,10);
    AddConsequence("inform","[Quest gelöst] Du erhältst 200 Kupferstücke und deine Bergbaufertigkeit steigt. Dein Ansehen bei Don Valerio Guilianni steigt.");
    AddConsequence("rankpoints","galmair","+",20);
    AddConsequence("money","+",200);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",8);
    AddTraderTrigger(".+","Oh, fine, wood. Not only won't the sky fall on my head down here, but also the ceiling won't.");
    AddCondition("qpg","=",7);
    AddCondition("item",3,"all",">",9);
    AddCondition("town","=","galmair");
    AddCondition("lang","english");
    AddConsequence("deleteitem",3,10);
    AddConsequence("inform","[Quest solved] You are awarded 200 copper coins and your mining skill increases. You advance in Don Valerio Guilianni's favour.");
    AddConsequence("rankpoints","galmair","+",20);
    AddConsequence("money","+",200);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",8);
    AddTraderTrigger(".+","Oh, gut, Holz! Fällt mir hier unten nicht nur nicht der Himmel, sondern auch nicht die Decke auf den Kopf.");
    AddCondition("qpg","=",7);
    AddCondition("item",3,"all",">",9);
    AddCondition("lang","german");
    AddConsequence("deleteitem",3,10);
    AddConsequence("inform","[Quest gelöst] Du erhältst 200 Kupferstücke und deine Bergbaufertigkeit steigt.");
    AddConsequence("money","+",200);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",8);
    AddTraderTrigger(".+","Oh, fine, wood. Not only won't the sky fall on my head down here, but also the ceiling won't.");
    AddCondition("qpg","=",7);
    AddCondition("item",3,"all",">",9);
    AddCondition("lang","english");
    AddConsequence("deleteitem",3,10);
    AddConsequence("inform","[Quest solved] You are awarded 200 copper coins and your mining skill increases.");
    AddConsequence("money","+",200);
    AddConsequence("skill","crafting","mining","+",1);
    AddConsequence("qpg","=",8);
    AddTraderTrigger(".+","Du kommst ohne Nadelholz wieder? Hat Valandil dich beim Holzfällen erwischt?");
    AddCondition("qpg","=",7);
    AddCondition("item",3,"all","<",10);
    AddCondition("lang","german");
    AddTraderTrigger(".+","You come back without conifer wood? Did Valandil catch you, chopping trees?");
    AddCondition("qpg","=",7);
    AddCondition("item",3,"all","<",10);
    AddCondition("lang","english");
    -- Final dialogue: No more quests, just nice hints
    AddTraderTrigger("quest","I thank you for all you did, you made the world a better place. Or you changed nothing, but got money.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",8);
    AddCondition("lang","english");
    AddTraderTrigger("quest","Ich danke dir, für alles, was du getan hast. Du hast die Welt zu einem besseren Ort gemacht. Oder du hast nichts bewirkt, aber ordentlich abkassiert.");
    AddAdditionalTrigger("mission");
    AddCondition("qpg","=",8);
    AddCondition("lang","german");
    AddTraderTrigger("task","I thank you for all you did, you made the world a better place. Or you changed nothing, but got money.");
    AddAdditionalTrigger("adventure");
    AddCondition("qpg","=",8);
    AddTraderTrigger("Auftrag","Ich danke dir, für alles, was du getan hast. Du hast die Welt zu einem besseren Ort gemacht. Oder du hast nichts bewirkt, aber ordentlich abkassiert.");
    AddAdditionalTrigger("Aufgabe");
    AddAdditionalTrigger("Abenteuer");
    AddCondition("qpg","=",8);
    -- Last catch: Think about keyphrases the player might say and that are not caught until here
    AddTraderTrigger("Yes","What was first, yes or no? I mean, did people first think about how to agree or how to disagree?");
    AddAdditionalText("Indeed.");
    AddAdditionalText("Yes?");
    AddTraderTrigger("Ja","Was war wohl zuerst da, ja oder nein? Ich meine, haben sich die Leute zuerst überlegt, zuzustimmen oder abzulehnen?");
    AddAdditionalText("Jawohl.");
    AddAdditionalText("Ja?");
    AddTraderTrigger("No","I say yes, you say no, I say goodbye, you say hello!");
    AddAdditionalText("No?");
    AddAdditionalText("Why?");
    AddTraderTrigger("Nein","Ich sage ja, du sagst nein, ich sage tschüß, du sagst hallo!");
    AddAdditionalText("Nein?");
    AddAdditionalText("Wieso?");
    AddTraderTrigger("nuts","I am what I am. And what are you, something else?");
    AddAdditionalTrigger("nutty");
    AddAdditionalTrigger("strange");
    AddAdditionalTrigger("wierd");
    AddAdditionalTrigger("loony");
    AddAdditionalText("That's all a matter of perspective.");
    AddAdditionalText("Points of view!");
    AddTraderTrigger("komisch","Ich bin, was ich bin. Und was bist du, was anderes?");
    AddAdditionalTrigger("bescheuert");
    AddAdditionalTrigger("dusselig");
    AddAdditionalText("Das ist alles Ansichtssache.");
    AddAdditionalText("Meinungen.");
    AddTraderTrigger("ROFL","#me laughes out loud.");
    -- Cycletext: Please add at least(!) five cycletext messages. The more, the better. You can use emotes (#me is green), too. 
    AddCycleText("Ich frag mich, was wir sagen würden, wenn der Boden dauernd auf uns rumtrampeln würde. Er ist ziemlich ruhig...","I wonder what we would say if the ground would stomp on us. It is quite silent...");
    AddCycleText("Ist Dunkelheit das Fehlen von Licht oder Licht das Fehlen von Dunkeltheit?","Is darkness the lack of light or light the lack of darkness?");
    AddCycleText("#me hält einen funkelnden Edelstein vor seine zugekniffenen Augen und nickt langsam.","#me holds a gem in front of his eyes and nods slowly.");
    AddCycleText("Vorsicht vor den Steinen.","Beware of rocks.");
    AddCycleText("Wer braucht schon den Himmel, wenn man eine gut abgestützte Höhlendecke hat.","Who needs the sky when you have a well supported ceiling.");
    AddCycleText("Hela, heba, helloa.","Hela, heba, helloa.");
    -- ********* END DYNAMIC PART ********
    TradSpeakLang={0,1};
    TradStdLang=0;

    increaseLangSkill(TradSpeakLang);
    thisNPC.activeLanguage=TradStdLang;

end

function nextCycle()  -- ~10 times per second
    initializeNpc();
    SpeakerCycle();
end

function receiveText(texttype, message, originator)
    if BasicNPCChecks(originator,2) then
        if LangOK(originator,TradSpeakLang) then
            TellSmallTalk(message,originator);
        else
            Confused(
               "#me sieht dich leicht verwirrt an",
               "#me looks at you a little confused"
            );
        end
    end
end